#!/bin/bash
set -e

# Setup paths
BASE_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
VERSION_FILE="$BASE_DIR/VERSION"

# 1. Read current version
if [ ! -f "$VERSION_FILE" ]; then
    echo "1.0.0" > "$VERSION_FILE"
fi

CURRENT_VERSION=$(cat "$VERSION_FILE")
IFS='.' read -r major minor patch <<< "$CURRENT_VERSION"

# 2. Increment Patch Version
new_patch=$((patch + 1))
NEW_VERSION="$major.$minor.$new_patch"

# 3. Update File
echo "$NEW_VERSION" > "$VERSION_FILE"
echo "ðŸ”– Bumped version: $CURRENT_VERSION -> $NEW_VERSION"

# 4. Git Commit
git add "$VERSION_FILE"
git commit "$@"
